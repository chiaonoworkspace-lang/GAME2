<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>è¶…ç´šèŒƒå¯¬å…„å¼Ÿï¼šè°¿å±±è¡Œæ—…ç¯‡</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: "KaiTi", "BiauKai", serif; /* æ¥·é«”æ›´å…·æ°´å¢¨æ„Ÿ */
        }
        #gameCanvas {
            border: 8px double #5d4037;
            background-color: #f0e6d2; /* ä»¿å¤å®£ç´™è‰² */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #ui {
            position: absolute;
            top: 20px;
            color: #3e2723;
            font-size: 20px;
            text-align: center;
            pointer-events: none;
        }
        .instruction {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div id="ui">
    <div>è°¿å±±è¡Œæ—…ï¼šèŒƒå¯¬çš„è©¦ç…‰</div>
    <div id="scoreBoard">éŠæ­·åˆ†æ•¸: 0 | å°‹ç²çœŸè·¡: å¦</div>
    <div class="instruction">æ“ä½œï¼šå·¦å³éµç§»å‹•ï¼Œç©ºç™½éµè·³èº | ç›®æ¨™ï¼šå°‹æ‰¾æ¨¹è”­ä¸‹çš„ç°½åä¸¦æŠµé”çµ‚é»</div>
</div>
<canvas id="gameCanvas" width="800" height="450"></canvas>

<script>
// --- éŠæˆ²è¨­å®š ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// éŠæˆ²ç‹€æ…‹
let gameRunning = true;
let score = 0;
let secretFound = false; // æ˜¯å¦æ‰¾åˆ°èŒƒå¯¬ç°½å
let frame = 0;

// ç‰©ç†åƒæ•¸
const GRAVITY = 0.6;
const FRICTION = 0.8;
const JUMP_FORCE = -12;
const SPEED = 5;

// ä¸»è§’ï¼šèŒƒå¯¬ (Fan Kuan)
const player = {
    x: 50,
    y: 300,
    width: 30,
    height: 40,
    velX: 0,
    velY: 0,
    grounded: false,
    color: '#2c3e50', // å¢¨è‰²è¡£è‘—
    facingRight: true
};

// åœ°åœ–ç‰©ä»¶ (æ ¹æ“šæ–‡ä»¶å…§å®¹è¨­è¨ˆ)
// åŒ…å«ï¼šåœ°é¢ã€å·¨çŸ³ã€æ¨¹æœ¨(éš±è—é»)ã€çµ‚é»
const platforms = [
    // åœ°é¢
    { x: 0, y: 400, w: 2000, h: 50, type: 'ground' },
    // è¿‘æ™¯å·¨çŸ³ (å¹³å°)
    { x: 200, y: 320, w: 80, h: 30, type: 'rock' },
    { x: 350, y: 250, w: 100, h: 30, type: 'rock' },
    // ä¸­æ™¯å±±å¾‘
    { x: 550, y: 300, w: 150, h: 20, type: 'ground' },
    // å³è§’æ¨¹è”­ (è—ç°½åè™•)
    { x: 850, y: 220, w: 100, h: 20, type: 'leaves', hasSecret: true },
    // é€šå¾€ä¸»å±±çš„è·³å°
    { x: 1050, y: 300, w: 80, h: 30, type: 'rock' },
    { x: 1200, y: 200, w: 200, h: 30, type: 'rock' } // çµ‚é»å¹³å°
];

// é©¢éšŠ (æ”¶é›†å“) - æ–‡ä»¶ä¸­æåˆ°çš„ã€Œé©¢éšŠã€
const donkeys = [
    { x: 600, y: 270, w: 20, h: 20, collected: false },
    { x: 1100, y: 270, w: 20, h: 20, collected: false }
];

// æ”å½±æ©Ÿ
let cameraX = 0;

// éµç›¤è¼¸å…¥
const keys = {
    right: false,
    left: false,
    up: false
};

document.addEventListener('keydown', (e) => {
    if (e.code === 'ArrowRight') keys.right = true;
    if (e.code === 'ArrowLeft') keys.left = true;
    if (e.code === 'Space' || e.code === 'ArrowUp') keys.up = true;
});

document.addEventListener('keyup', (e) => {
    if (e.code === 'ArrowRight') keys.right = false;
    if (e.code === 'ArrowLeft') keys.left = false;
    if (e.code === 'Space' || e.code === 'ArrowUp') keys.up = false;
});

// --- ç¹ªåœ–å‡½æ•¸ ---

// ç¹ªè£½èƒŒæ™¯ (ä¸»å±±ã€ç€‘å¸ƒã€é›¨é»çš´)
function drawBackground() {
    // å¤©ç©º/ç´™è‰²
    ctx.fillStyle = '#f0e6d2';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // é æ™¯ï¼šå·å³¨ä¸»å±± (å›ºå®šåœ¨èƒŒæ™¯ï¼Œè¦–å·®æ»¾å‹•è¼ƒæ…¢)
    ctx.save();
    ctx.translate(-cameraX * 0.2, 0); // è¦–å·®æ•ˆæœ
    
    // ä¸»å±±è¼ªå»“
    ctx.beginPath();
    ctx.moveTo(300, 450);
    ctx.lineTo(400, 50); // å±±é ‚
    ctx.lineTo(500, 450);
    ctx.fillStyle = 'rgba(60, 60, 60, 0.3)'; // æ·¡å¢¨
    ctx.fill();
    
    // é£›ç€‘ (ç•™ç™½)
    ctx.fillStyle = '#fff';
    ctx.fillRect(415, 50, 10, 400);

    // é›¨é»çš´ (éš¨æ©Ÿç•«é»è¡¨ç¾è³ªæ„Ÿ)
    ctx.fillStyle = 'rgba(0,0,0,0.1)';
    for(let i=0; i<100; i++) {
        let rx = 300 + Math.random() * 200;
        let ry = 50 + Math.random() * 400;
        ctx.fillRect(rx, ry, 2, 2);
    }
    ctx.restore();
}

function update() {
    if (!gameRunning) return;

    // ç©å®¶ç§»å‹•
    if (keys.right) {
        player.velX < SPEED ? player.velX++ : player.velX = SPEED;
        player.facingRight = true;
    }
    if (keys.left) {
        player.velX > -SPEED ? player.velX-- : player.velX = -SPEED;
        player.facingRight = false;
    }

    player.velX *= FRICTION;
    player.velY += GRAVITY;

    player.grounded = false;

    // ç¢°æ’åµæ¸¬ (èˆ‡å¹³å°)
    platforms.forEach(plat => {
        // ç°¡å–®çš„AABBç¢°æ’
        if (player.x < plat.x + plat.w &&
            player.x + player.width > plat.x &&
            player.y < plat.y + plat.h &&
            player.y + player.height > plat.y) {
            
            // å¾ä¸Šæ–¹è½ä¸‹
            if (player.velY > 0 && player.y + player.height - player.velY <= plat.y) {
                player.grounded = true;
                player.velY = 0;
                player.y = plat.y - player.height;
            } 
            // æ’é ­ (ç”¨æ–¼è§¸ç™¼éš±è—ç£šå¡Š)
            else if (player.velY < 0 && player.y - player.velY >= plat.y + plat.h) {
                player.velY = 0;
                player.y = plat.y + plat.h;
                if (plat.hasSecret && !secretFound) {
                    secretFound = true;
                    score += 1000;
                    alert("ç™¼ç¾éš±è—æ¬¾è­˜ï¼šã€ŒèŒƒå¯¬ã€ï¼ (å¾—åˆ† +1000)");
                    document.getElementById('scoreBoard').innerText = `éŠæ­·åˆ†æ•¸: ${score} | å°‹ç²çœŸè·¡: æ˜¯ (èŒƒå¯¬)`;
                }
            }
        }
    });

    if (player.grounded && keys.up) {
        player.velY = JUMP_FORCE;
        player.grounded = false;
    }

    player.x += player.velX;
    player.y += player.velY;

    // æ”¶é›†é©¢éšŠ
    donkeys.forEach(donkey => {
        if (!donkey.collected && 
            player.x < donkey.x + donkey.w &&
            player.x + player.width > donkey.x &&
            player.y < donkey.y + donkey.h &&
            player.y + player.height > donkey.y) {
            
            donkey.collected = true;
            score += 100;
            document.getElementById('scoreBoard').innerText = `éŠæ­·åˆ†æ•¸: ${score} | å°‹ç²çœŸè·¡: ${secretFound ? "æ˜¯ (èŒƒå¯¬)" : "å¦"}`;
        }
    });

    // é‚Šç•Œæª¢æŸ¥
    if (player.x < 0) player.x = 0;
    if (player.y > canvas.height) {
        // æ‰è½æ·±æ·µï¼Œé‡ç½®
        player.x = 50;
        player.y = 300;
        score = Math.max(0, score - 50);
        document.getElementById('scoreBoard').innerText = `éŠæ­·åˆ†æ•¸: ${score} | å°‹ç²çœŸè·¡: ${secretFound ? "æ˜¯ (èŒƒå¯¬)" : "å¦"}`;
    }

    // æ”å½±æ©Ÿè·Ÿéš¨
    if (player.x > 300) {
        cameraX = player.x - 300;
    }
    
    // å‹åˆ©åˆ¤å®š
    if (player.x > 1300) {
        gameRunning = false;
        setTimeout(() => {
            alert(`æ­å–œï¼ä½ å®Œæˆäº†è°¿å±±è¡Œæ—…åœ–çš„éŠæ­·ã€‚\næœ€çµ‚å¾—åˆ†ï¼š${score}\n${secretFound ? "å¤ªæ£’äº†ï¼ä½ ç™¼ç¾äº†è—åœ¨æ¨¹è”­ä¸‹çš„èŒƒå¯¬ç°½åï¼" : "å¯æƒœï¼Œä½ æ²’æœ‰ç™¼ç¾ç•«ä½œä¸­éš±è—çš„ç§˜å¯†(ç°½å)ã€‚"}`);
            location.reload();
        }, 100);
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    drawBackground();

    ctx.save();
    ctx.translate(-cameraX, 0);

    // ç¹ªè£½å¹³å°
    platforms.forEach(plat => {
        if (plat.type === 'ground') ctx.fillStyle = '#3e2723'; // åœŸè‰²
        else if (plat.type === 'rock') ctx.fillStyle = '#5d4037'; // å²©çŸ³
        else if (plat.type === 'leaves') ctx.fillStyle = '#2e7d32'; // æ¨¹è‘‰
        
        ctx.fillRect(plat.x, plat.y, plat.w, plat.h);
        
        // ç•«é»è³ªæ„Ÿ (çš´æ³•)
        ctx.strokeStyle = '#000';
        ctx.strokeRect(plat.x, plat.y, plat.w, plat.h);
    });

    // ç¹ªè£½é©¢éšŠ (æ”¶é›†å“)
    donkeys.forEach(donkey => {
        if (!donkey.collected) {
            ctx.font = '20px Arial';
            ctx.fillText('ğŸ«', donkey.x, donkey.y + 20);
        }
    });

    // ç¹ªè£½ä¸»è§’ (èŒƒå¯¬)
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
    
    // ç°¡å–®çš„è‡‰éƒ¨/ç‰¹å¾µ
    ctx.fillStyle = '#ffe0b2'; // è†šè‰²
    ctx.fillRect(player.x + 5, player.y + 5, 20, 15);
    ctx.fillStyle = '#000'; // é¬é¬š (èŒƒå¯¬å„€æ…‹ç–é‡)
    ctx.fillRect(player.x + 5, player.y + 15, 20, 5);

    // éš±è—ç°½åé¡¯ç¤º (å¦‚æœè¢«æ’æ“Šé)
    if (secretFound) {
        ctx.fillStyle = '#000';
        ctx.font = '16px KaiTi';
        ctx.fillText('èŒƒå¯¬', 880, 200); // é¡¯ç¤ºåœ¨æ¨¹è‘‰ä¸Šæ–¹
    }

    // çµ‚é»æç¤º
    ctx.font = '30px Arial';
    ctx.fillText('ğŸ”ï¸', 1300, 190);

    ctx.restore();

    requestAnimationFrame(() => {
        update();
        draw();
    });
}

// å•Ÿå‹•éŠæˆ²
draw();

</script>
</body>
</html>
    
  </body>
  
</html>
